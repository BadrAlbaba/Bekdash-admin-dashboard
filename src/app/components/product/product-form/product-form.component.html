<h4 class="mb-4">{{ productId ? "Edit Product" : "Add Product" }}</h4>

<form
  [formGroup]="productForm"
  (ngSubmit)="onSubmit()"
  class="p-4 border rounded bg-light"
>
  <!-- Title -->
  <div class="mb-3">
    <label>Title</label>
    <input formControlName="title" class="form-control" />
  </div>

  <!-- Description -->
  <div class="mb-3">
    <label>Description</label>
    <quill-editor
      formControlName="description"
      [styles]="{ height: '200px', width: '100%' }"
      [placeholder]="'Enter product description...'"
      [modules]="quillModules"
      class="form-control quill-custom"
    ></quill-editor>
  </div>

  <!-- Price -->
  <div class="mb-3">
    <label>Price</label>
    <input type="number" formControlName="price" class="form-control" />
  </div>

  <!-- Stock -->
  <div class="mb-3">
    <label>Stock</label>
    <input type="number" formControlName="stock" class="form-control" />
  </div>

  <!-- Categories -->
  <div class="mb-3">
    <label>Categories</label>
    <ng-select
      [items]="categories"
      bindLabel="name"
      bindValue="id"
      formControlName="categoryIds"
      [multiple]="true"
      [closeOnSelect]="false"
      placeholder="Select categories"
      class="form-control"
    ></ng-select>
  </div>

  <!-- Active -->
  <div class="mb-3 form-check">
    <input
      type="checkbox"
      formControlName="active"
      class="form-check-input"
      id="activeCheck"
    />
    <label class="form-check-label" for="activeCheck">Active</label>
  </div>

  <!-- Thumbnail Upload -->
  <div class="mb-3">
    <label>Upload Thumbnail</label>
    <input
      type="file"
      (change)="onThumbnailSelected($event)"
      class="form-control"
    />
  </div>

  <!-- Existing Thumbnail -->
  <div *ngIf="productThumbnail && !thumbnailPreviewUrl" class="mt-2">
    <h6 class="text-muted">Current Thumbnail</h6>
    <div class="position-relative" style="width: 100px">
      <img
        [src]="getImageUrl(productThumbnail)"
        class="img-thumbnail w-100 p-1"
        style="height: auto"
      />
      <button
        type="button"
        class="btn-close position-absolute"
        style="top: 2px; right: 2px"
        aria-label="Remove"
        (click)="removeExistingThumbnail()"
      ></button>
    </div>
  </div>

  <!-- Thumbnail preview -->
  <div *ngIf="thumbnailPreviewUrl" class="mt-2">
    <h6 class="text-muted">New Thumbnail Preview</h6>
    <div class="position-relative" style="width: 100px">
      <img
        [src]="thumbnailPreviewUrl"
        class="img-thumbnail w-100 p-1"
        style="height: auto"
      />
      <button
        type="button"
        class="btn-close position-absolute"
        style="top: 2px; right: 2px"
        aria-label="Remove"
        (click)="removeThumbnailPreview()"
      ></button>
    </div>
  </div>

  <!-- Product Images Upload -->
  <div class="mb-3 mt-3">
    <label>Upload Product Images</label>
    <input
      type="file"
      (change)="onImageSelected($event)"
      multiple
      class="form-control"
    />
  </div>

  <!-- Existing images -->
  <div *ngIf="productImages.length" class="mt-2">
    <label>Current Product Images:</label>
    <div class="d-flex flex-wrap gap-2">
      <div
        class="position-relative"
        *ngFor="let img of productImages; let i = index"
      >
        <img
          [src]="getImageUrl(img.url)"
          class="img-thumbnail"
          style="width: 70px; height: auto"
        />
        <button
          type="button"
          class="btn-close position-absolute top-0 end-0"
          aria-label="Remove"
          (click)="onRemoveImage(img.id, i)"
        ></button>
      </div>
    </div>
  </div>

  <!-- New Image Previews -->
  <div *ngIf="imagePreviewUrls.length" class="mt-2">
    <h6 class="text-muted">New Image Previews</h6>
    <div class="d-flex flex-wrap gap-2">
      <div
        class="position-relative"
        style="width: 70px"
        *ngFor="let imgUrl of imagePreviewUrls; let i = index"
      >
        <img
          [src]="imgUrl"
          class="img-thumbnail w-100 p-1"
          style="height: auto"
        />
        <button
          type="button"
          class="btn-close position-absolute"
          style="top: 2px; right: 2px"
          aria-label="Remove"
          (click)="removeImagePreview(i)"
        ></button>
      </div>
    </div>
  </div>

  <!-- Submit -->
  <button type="submit" class="btn btn-primary mt-3" [disabled]="loading">
    <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
    {{
      loading
        ? "Processing..."
        : productId
        ? "Update Product"
        : "Create Product"
    }}
  </button>

  <!-- Cancel -->
  <a
    type="button"
    class="btn btn-outline-secondary mt-3 ms-2"
    (click)="onCancel()"
  >
    Cancel
  </a>
</form>
